<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Наявність деталей для індивідуального годинника</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #e6e6e6;
      color: #111;
    }
    h1 {
      text-align: center;
      margin: 20px 0 10px;
      font-size: 26px;
      font-weight: 600;
    }
    #search-bar {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    #searchInput {
      padding: 8px 12px;
      font-size: 16px;
      width: 240px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #searchButton {
      padding: 8px 18px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background-color: #111;
      color: #fff;
      cursor: pointer;
    }
    .models-container {
      max-width: 640px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      padding: 20px;
    }
    .model-entry {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      margin-bottom: 8px;
      border: 1px solid transparent;
      border-radius: 10px;
      cursor: pointer;
      background: #fff;
      transition: background 0.2s, border 0.2s;
    }
    .model-entry:hover {
      background: #f0f0f0;
    }
    .model-entry.active {
      background-color: #fff7db;
      border: 1px solid #f9cb40;
    }
    .model-code {
      font-weight: 600;
      font-size: 14px;
    }
    .model-title {
      font-size: 13px;
      margin-left: 8px;
      color: #333;
    }
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: auto;
    }
    .green { background: #2ecc71; }
    .red { background: #e74c3c; }

    .parts-popup {
      position: absolute;
      left: 360px;
      width: max-content;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 10px;
      font-size: 13px;
      z-index: 100;
      animation: fadeIn 0.2s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .parts-popup table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 8px;
    }
    .parts-popup th, .parts-popup td {
      border: 1px solid #ddd;
      padding: 4px 6px;
      text-align: center;
    }
    .parts-popup th {
      background: #f8f8f8;
      font-weight: 600;
    }
    .part-img {
      height: 40px;
      transition: transform 0.2s;
    }
    .part-img:hover {
      transform: scale(2);
    }
    .zero-stock {
      background: #ffe5e5;
      color: #a00;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Наявність деталей для індивідуального годинника</h1>
  <div id="search-bar">
    <input type="text" id="searchInput" placeholder="Введіть артикул...">
    <button id="searchButton">Пошук</button>
  </div>
  <div class="models-container" id="modelsContainer">
    <h3 style="text-align:center; margin-bottom:10px">Доступні моделі годинників</h3>
    <div id="modelsList"></div>
  </div>
  <script>
    let activePopup = null;
    let activeModel = null;

    const filteredModels = models.filter(m => !m.name.startsWith("Годинник наручний") && !m.name.startsWith("Сталевий браслет"));

    function renderModels() {
      const container = document.getElementById('modelsList');
      container.innerHTML = '';
      filteredModels.forEach(model => {
        const div = document.createElement('div');
        div.className = 'model-entry';
        div.dataset.code = model.code;
        div.innerHTML = `
          <div>
            <span class="model-code">${model.code}</span>
            <span class="model-title"> — ${model.name}</span>
          </div>
          <div class="status-dot ${model.hasAllParts ? 'green' : 'red'}"></div>
        `;
        div.addEventListener('click', (e) => togglePartsTable(e, model.code, div));
        container.appendChild(div);
      });
    }

    function togglePartsTable(e, code, div) {
      if (activePopup) activePopup.remove();
      if (activeModel === div) {
        activeModel.classList.remove('active');
        activeModel = null;
        return;
      }
      document.querySelectorAll('.model-entry').forEach(d => d.classList.remove('active'));
      div.classList.add('active');
      activeModel = div;
      showPartsPopup(div, code);
    }

    function showPartsPopup(triggerElement, code) {
      const parts = getPartsByModelCode(code); // отримати дані
      const popup = document.createElement('div');
      popup.className = 'parts-popup';
      const rect = triggerElement.getBoundingClientRect();
      popup.style.top = `${window.scrollY + rect.top}px`;

      let rows = parts.map(p => `
        <tr>
          <td><img class="part-img" src="${p.photo}"/></td>
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.income}</td>
          <td>${p.outcome}</td>
          <td class="${p.stock === 0 ? 'zero-stock' : ''}">${p.stock}</td>
        </tr>`).join('');

      popup.innerHTML = `
        <table>
          <thead>
            <tr><th>Фото</th><th>Артикул</th><th>Назва</th><th>Прих.</th><th>Розх.</th><th>Зал.</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>`;

      document.body.appendChild(popup);
      activePopup = popup;
    }

    document.getElementById('searchInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') searchParts();
    });
    document.getElementById('searchButton').addEventListener('click', searchParts);

    function searchParts() {
      const code = document.getElementById('searchInput').value.trim();
      if (!code) return;
      if (activePopup) activePopup.remove();
      document.querySelectorAll('.model-entry').forEach(d => d.classList.remove('active'));
      activeModel = null;
      const trigger = document.getElementById('search-bar');
      showPartsPopup(trigger, code);
    }

    // Проста демо-структура
    const models = [
      { code: "1202-0162", name: "020 Gold-Gold", hasAllParts: true },
      { code: "1202-0163", name: "020 Silver-Silver", hasAllParts: true },
      { code: "1202-0270", name: "021 Black Steel", hasAllParts: false }
    ];

    function getPartsByModelCode(code) {
      if (code === "1202-0270") return [
        { photo: "https://via.placeholder.com/40", code: "1044-0170", name: "Sanda 7013 Black Mesh", income: 20, outcome: 0, stock: 20 },
        { photo: "https://via.placeholder.com/40", code: "8000-0383", name: "Сталевий браслет Awarder 021 Black 22 мм", income: 37, outcome: 0, stock: 37 },
      ];
      return [
        { photo: "https://via.placeholder.com/40", code: "8000-0153", name: "Корпус для годинника AWARDER 020 Срібло", income: 79, outcome: 0, stock: 79 },
        { photo: "https://via.placeholder.com/40", code: "1051-0641", name: "Шкіряний ремінець Premium 18x16 мм. Black", income: 508, outcome: 0, stock: 508 },
        { photo: "https://via.placeholder.com/40", code: "8000-0155", name: "Циферблат для годинника AWARDER 020 Срібло", income: 104, outcome: 0, stock: 104 }
      ];
    }

    renderModels();
  </script>
</body>
</html>
